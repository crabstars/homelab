{"version":4,"terraform_version":"1.9.0","serial":19,"lineage":"59e3e8e9-dc95-305b-57c6-9f6fe4144a11","outputs":{},"resources":[{"mode":"managed","type":"helm_release","name":"kube_prometheus_stack","provider":"provider[\"registry.opentofu.org/hashicorp/helm\"]","instances":[{"schema_version":1,"attributes":{"atomic":false,"chart":"kube-prometheus-stack","cleanup_on_fail":false,"create_namespace":false,"dependency_update":false,"description":null,"devel":null,"disable_crd_hooks":false,"disable_openapi_validation":false,"disable_webhooks":false,"force_update":false,"id":"kube-prometheus","keyring":null,"lint":false,"manifest":null,"max_history":0,"metadata":[{"app_version":"v0.81.0","chart":"kube-prometheus-stack","first_deployed":1745092367,"last_deployed":1745179958,"name":"kube-prometheus","namespace":"monitoring","notes":"1. Get the application URL by running these commands:\n  export POD_NAME=$(kubectl get pods --namespace monitoring -l \"app.kubernetes.io/name=prometheus-node-exporter,app.kubernetes.io/instance=kube-prometheus\" -o jsonpath=\"{.items[0].metadata.name}\")\n  echo \"Visit http://127.0.0.1:9100 to use your application\"\n  kubectl port-forward --namespace monitoring $POD_NAME 9100\n1. Get your 'admin' user password by running:\n\n   kubectl get secret --namespace monitoring kube-prometheus-grafana -o jsonpath=\"{.data.admin-password}\" | base64 --decode ; echo\n\n\n2. The Grafana server can be accessed via port 80 on the following DNS name from within your cluster:\n\n   kube-prometheus-grafana.monitoring.svc.cluster.local\n\n   Get the Grafana URL to visit by running these commands in the same shell:\n     export POD_NAME=$(kubectl get pods --namespace monitoring -l \"app.kubernetes.io/name=grafana,app.kubernetes.io/instance=kube-prometheus\" -o jsonpath=\"{.items[0].metadata.name}\")\n     kubectl --namespace monitoring port-forward $POD_NAME 3000\n\n3. Login with the password from step 1 and the username: admin\n\nkube-prometheus-stack has been installed. Check its status by running:\n  kubectl --namespace monitoring get pods -l \"release=kube-prometheus\"\n\nGet Grafana 'admin' user password by running:\n\n  kubectl --namespace monitoring get secrets kube-prometheus-grafana -o jsonpath=\"{.data.admin-password}\" | base64 -d ; echo\n\nAccess Grafana local instance:\n\n  export POD_NAME=$(kubectl --namespace monitoring get pod -l \"app.kubernetes.io/name=grafana,app.kubernetes.io/instance=kube-prometheus\" -oname)\n  kubectl --namespace monitoring port-forward $POD_NAME 3000\n\nVisit https://github.com/prometheus-operator/kube-prometheus for instructions on how to create \u0026 configure Alertmanager and Prometheus instances using the Operator.\n\nkube-state-metrics is a simple service that listens to the Kubernetes API server and generates metrics about the state of the objects.\nThe exposed metrics can be found here:\nhttps://github.com/kubernetes/kube-state-metrics/blob/master/docs/README.md#exposed-metrics\n\nThe metrics are exported on the HTTP endpoint /metrics on the listening port.\nIn your case, kube-prometheus-kube-state-metrics.monitoring.svc.cluster.local:8080/metrics\n\nThey are served either as plaintext or protobuf depending on the Accept header.\nThey are designed to be consumed either by Prometheus itself or by a scraper that is compatible with scraping a Prometheus client endpoint.\n","revision":4,"values":"{\"grafana\":{\"adminPassword\":\"428hfJKSDUb!nfiod?d0wf\",\"datasources\":{\"datasources.yaml\":{\"apiVersion\":1,\"datasources\":[{\"access\":\"proxy\",\"isDefault\":true,\"name\":\"prometheus-longhorn\",\"type\":\"prometheus\",\"url\":\"http://kube-prometheus-kube-prome-prometheus.monitoring.svc:9090\"}]}},\"persistence\":{\"enabled\":true,\"existingClaim\":\"grafana-data\"}},\"prometheus\":{\"prometheusSpec\":{\"serviceMonitorSelectorNilUsesHelmValues\":false,\"storageSpec\":{\"volumeClaimTemplate\":{\"spec\":{\"accessModes\":[\"ReadWriteOnce\"],\"resources\":{\"requests\":{\"storage\":\"5Gi\"}},\"storageClassName\":\"longhorn\"}}}}}}","version":"70.7.0"}],"name":"kube-prometheus","namespace":"monitoring","pass_credentials":false,"postrender":[],"recreate_pods":false,"render_subchart_notes":true,"replace":false,"repository":"https://prometheus-community.github.io/helm-charts","repository_ca_file":null,"repository_cert_file":null,"repository_key_file":null,"repository_password":null,"repository_username":null,"reset_values":false,"reuse_values":false,"set":[],"set_list":[],"set_sensitive":[],"skip_crds":false,"status":"deployed","timeout":300,"upgrade_install":null,"values":["# Prometheus config\nprometheus:\n  prometheusSpec:\n    serviceMonitorSelectorNilUsesHelmValues: false\n    storageSpec:\n      volumeClaimTemplate:\n        spec:\n          storageClassName: longhorn\n          accessModes: [\"ReadWriteOnce\"]\n          resources:\n            requests:\n              storage: 5Gi\n\n# Grafana config\ngrafana:\n  persistence:\n    enabled: true\n    existingClaim: grafana-data\n  adminPassword: 428hfJKSDUb!nfiod?d0wf\n\n  datasources:\n    datasources.yaml:\n      apiVersion: 1\n      datasources:\n        - name: prometheus-longhorn\n          type: prometheus\n          url: http://kube-prometheus-kube-prome-prometheus.monitoring.svc:9090\n          access: proxy\n          isDefault: true\n"],"verify":false,"version":"70.7.0","wait":true,"wait_for_jobs":false},"sensitive_attributes":[[{"type":"get_attr","value":"repository_password"}]],"private":"eyJzY2hlbWFfdmVyc2lvbiI6IjEifQ==","dependencies":["kubernetes_namespace.monitoring"]}]},{"mode":"managed","type":"kubernetes_manifest","name":"longhorn_service_monitor","provider":"provider[\"registry.opentofu.org/hashicorp/kubernetes\"]","instances":[{"schema_version":1,"attributes":{"computed_fields":null,"field_manager":[],"manifest":{"value":{"apiVersion":"monitoring.coreos.com/v1","kind":"ServiceMonitor","metadata":{"name":"longhorn","namespace":"monitoring"},"spec":{"endpoints":[{"interval":"30s","path":"/metrics","port":"9500"}],"namespaceSelector":{"matchNames":["longhorn-system"]},"selector":{"matchLabels":{"app.kubernetes.io/instance":"longhorn","app.kubernetes.io/name":"longhorn"}}}},"type":["object",{"apiVersion":"string","kind":"string","metadata":["object",{"name":"string","namespace":"string"}],"spec":["object",{"endpoints":["tuple",[["object",{"interval":"string","path":"string","port":"string"}]]],"namespaceSelector":["object",{"matchNames":["tuple",["string"]]}],"selector":["object",{"matchLabels":["object",{"app.kubernetes.io/instance":"string","app.kubernetes.io/name":"string"}]}]}]}]},"object":{"value":{"apiVersion":"monitoring.coreos.com/v1","kind":"ServiceMonitor","metadata":{"annotations":null,"creationTimestamp":null,"deletionGracePeriodSeconds":null,"deletionTimestamp":null,"finalizers":null,"generateName":null,"generation":null,"labels":null,"managedFields":null,"name":"longhorn","namespace":"monitoring","ownerReferences":null,"resourceVersion":null,"selfLink":null,"uid":null},"spec":{"attachMetadata":{"node":null},"bodySizeLimit":null,"endpoints":[{"authorization":{"credentials":{"key":null,"name":null,"optional":null},"type":null},"basicAuth":{"password":{"key":null,"name":null,"optional":null},"username":{"key":null,"name":null,"optional":null}},"bearerTokenFile":null,"bearerTokenSecret":{"key":null,"name":null,"optional":null},"enableHttp2":null,"filterRunning":null,"followRedirects":null,"honorLabels":null,"honorTimestamps":null,"interval":"30s","metricRelabelings":null,"oauth2":{"clientId":{"configMap":{"key":null,"name":null,"optional":null},"secret":{"key":null,"name":null,"optional":null}},"clientSecret":{"key":null,"name":null,"optional":null},"endpointParams":null,"noProxy":null,"proxyConnectHeader":null,"proxyFromEnvironment":null,"proxyUrl":null,"scopes":null,"tlsConfig":{"ca":{"configMap":{"key":null,"name":null,"optional":null},"secret":{"key":null,"name":null,"optional":null}},"cert":{"configMap":{"key":null,"name":null,"optional":null},"secret":{"key":null,"name":null,"optional":null}},"insecureSkipVerify":null,"keySecret":{"key":null,"name":null,"optional":null},"maxVersion":null,"minVersion":null,"serverName":null},"tokenUrl":null},"params":null,"path":"/metrics","port":"9500","proxyUrl":null,"relabelings":null,"scheme":null,"scrapeTimeout":null,"targetPort":null,"tlsConfig":{"ca":{"configMap":{"key":null,"name":null,"optional":null},"secret":{"key":null,"name":null,"optional":null}},"caFile":null,"cert":{"configMap":{"key":null,"name":null,"optional":null},"secret":{"key":null,"name":null,"optional":null}},"certFile":null,"insecureSkipVerify":null,"keyFile":null,"keySecret":{"key":null,"name":null,"optional":null},"maxVersion":null,"minVersion":null,"serverName":null},"trackTimestampsStaleness":null}],"fallbackScrapeProtocol":null,"jobLabel":null,"keepDroppedTargets":null,"labelLimit":null,"labelNameLengthLimit":null,"labelValueLengthLimit":null,"namespaceSelector":{"any":null,"matchNames":["longhorn-system"]},"nativeHistogramBucketLimit":null,"nativeHistogramMinBucketFactor":null,"podTargetLabels":null,"sampleLimit":null,"scrapeClass":null,"scrapeClassicHistograms":null,"scrapeProtocols":null,"selector":{"matchExpressions":null,"matchLabels":{"app.kubernetes.io/instance":"longhorn","app.kubernetes.io/name":"longhorn"}},"selectorMechanism":null,"targetLabels":null,"targetLimit":null}},"type":["object",{"apiVersion":"string","kind":"string","metadata":["object",{"annotations":["map","string"],"creationTimestamp":"string","deletionGracePeriodSeconds":"number","deletionTimestamp":"string","finalizers":["list","string"],"generateName":"string","generation":"number","labels":["map","string"],"managedFields":["tuple",[["object",{"apiVersion":"string","fieldsType":"string","fieldsV1":"dynamic","manager":"string","operation":"string","subresource":"string","time":"string"}]]],"name":"string","namespace":"string","ownerReferences":["list",["object",{"apiVersion":"string","blockOwnerDeletion":"bool","controller":"bool","kind":"string","name":"string","uid":"string"}]],"resourceVersion":"string","selfLink":"string","uid":"string"}],"spec":["object",{"attachMetadata":["object",{"node":"bool"}],"bodySizeLimit":"string","endpoints":["list",["object",{"authorization":["object",{"credentials":["object",{"key":"string","name":"string","optional":"bool"}],"type":"string"}],"basicAuth":["object",{"password":["object",{"key":"string","name":"string","optional":"bool"}],"username":["object",{"key":"string","name":"string","optional":"bool"}]}],"bearerTokenFile":"string","bearerTokenSecret":["object",{"key":"string","name":"string","optional":"bool"}],"enableHttp2":"bool","filterRunning":"bool","followRedirects":"bool","honorLabels":"bool","honorTimestamps":"bool","interval":"string","metricRelabelings":["list",["object",{"action":"string","modulus":"number","regex":"string","replacement":"string","separator":"string","sourceLabels":["list","string"],"targetLabel":"string"}]],"oauth2":["object",{"clientId":["object",{"configMap":["object",{"key":"string","name":"string","optional":"bool"}],"secret":["object",{"key":"string","name":"string","optional":"bool"}]}],"clientSecret":["object",{"key":"string","name":"string","optional":"bool"}],"endpointParams":["map","string"],"noProxy":"string","proxyConnectHeader":["map",["list",["object",{"key":"string","name":"string","optional":"bool"}]]],"proxyFromEnvironment":"bool","proxyUrl":"string","scopes":["list","string"],"tlsConfig":["object",{"ca":["object",{"configMap":["object",{"key":"string","name":"string","optional":"bool"}],"secret":["object",{"key":"string","name":"string","optional":"bool"}]}],"cert":["object",{"configMap":["object",{"key":"string","name":"string","optional":"bool"}],"secret":["object",{"key":"string","name":"string","optional":"bool"}]}],"insecureSkipVerify":"bool","keySecret":["object",{"key":"string","name":"string","optional":"bool"}],"maxVersion":"string","minVersion":"string","serverName":"string"}],"tokenUrl":"string"}],"params":["map",["list","string"]],"path":"string","port":"string","proxyUrl":"string","relabelings":["list",["object",{"action":"string","modulus":"number","regex":"string","replacement":"string","separator":"string","sourceLabels":["list","string"],"targetLabel":"string"}]],"scheme":"string","scrapeTimeout":"string","targetPort":"string","tlsConfig":["object",{"ca":["object",{"configMap":["object",{"key":"string","name":"string","optional":"bool"}],"secret":["object",{"key":"string","name":"string","optional":"bool"}]}],"caFile":"string","cert":["object",{"configMap":["object",{"key":"string","name":"string","optional":"bool"}],"secret":["object",{"key":"string","name":"string","optional":"bool"}]}],"certFile":"string","insecureSkipVerify":"bool","keyFile":"string","keySecret":["object",{"key":"string","name":"string","optional":"bool"}],"maxVersion":"string","minVersion":"string","serverName":"string"}],"trackTimestampsStaleness":"bool"}]],"fallbackScrapeProtocol":"string","jobLabel":"string","keepDroppedTargets":"number","labelLimit":"number","labelNameLengthLimit":"number","labelValueLengthLimit":"number","namespaceSelector":["object",{"any":"bool","matchNames":["list","string"]}],"nativeHistogramBucketLimit":"number","nativeHistogramMinBucketFactor":"string","podTargetLabels":["list","string"],"sampleLimit":"number","scrapeClass":"string","scrapeClassicHistograms":"bool","scrapeProtocols":["list","string"],"selector":["object",{"matchExpressions":["list",["object",{"key":"string","operator":"string","values":["list","string"]}]],"matchLabels":["map","string"]}],"selectorMechanism":"string","targetLabels":["list","string"],"targetLimit":"number"}]}]},"timeouts":[],"wait":[],"wait_for":null},"sensitive_attributes":[]}]},{"mode":"managed","type":"kubernetes_namespace","name":"monitoring","provider":"provider[\"registry.opentofu.org/hashicorp/kubernetes\"]","instances":[{"schema_version":0,"attributes":{"id":"monitoring","metadata":[{"annotations":{},"generate_name":"","generation":0,"labels":{},"name":"monitoring","resource_version":"157564","uid":"e547a20e-a8dc-4d29-9dd4-971ee1f6e9bd"}],"timeouts":null,"wait_for_default_service_account":false},"sensitive_attributes":[],"private":"eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiZGVsZXRlIjozMDAwMDAwMDAwMDB9fQ=="}]},{"mode":"managed","type":"kubernetes_persistent_volume_claim","name":"grafana_data","provider":"provider[\"registry.opentofu.org/hashicorp/kubernetes\"]","instances":[{"schema_version":0,"attributes":{"id":"monitoring/grafana-data","metadata":[{"annotations":{},"generate_name":"","generation":0,"labels":{},"name":"grafana-data","namespace":"monitoring","resource_version":"160817","uid":"c74566ed-73a5-4b6e-a50c-e9e9f9d6cafd"}],"spec":[{"access_modes":["ReadWriteOnce"],"resources":[{"limits":{},"requests":{"storage":"1Gi"}}],"selector":[],"storage_class_name":"longhorn","volume_mode":"Filesystem","volume_name":"pvc-c74566ed-73a5-4b6e-a50c-e9e9f9d6cafd"}],"timeouts":null,"wait_until_bound":true},"sensitive_attributes":[],"private":"eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjozMDAwMDAwMDAwMDB9fQ==","dependencies":["kubernetes_namespace.monitoring"]}]},{"mode":"managed","type":"kubernetes_persistent_volume_claim","name":"prometheus_data","provider":"provider[\"registry.opentofu.org/hashicorp/kubernetes\"]","instances":[{"schema_version":0,"attributes":{"id":"monitoring/prometheus-data","metadata":[{"annotations":{},"generate_name":"","generation":0,"labels":{},"name":"prometheus-data","namespace":"monitoring","resource_version":"160810","uid":"1781c8fa-f6dc-4c27-a7d3-9d5f359a3a76"}],"spec":[{"access_modes":["ReadWriteOnce"],"resources":[{"limits":{},"requests":{"storage":"5Gi"}}],"selector":[],"storage_class_name":"longhorn","volume_mode":"Filesystem","volume_name":"pvc-1781c8fa-f6dc-4c27-a7d3-9d5f359a3a76"}],"timeouts":null,"wait_until_bound":true},"sensitive_attributes":[],"private":"eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjozMDAwMDAwMDAwMDB9fQ==","dependencies":["kubernetes_namespace.monitoring"]}]}],"check_results":null}
